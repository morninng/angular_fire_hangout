"use strict";angular.module("angularFireHangoutApp",["ngAnimate","ui.router","firebase","ngSanitize"]),angular.module("angularFireHangoutApp").run(["$state","MixideaSetting",function(a,b){function c(b,c){switch(b){case"main":switch(c){case"introduction":a.go("main.introduction");break;case"preparation":a.go("main.preparation");break;case"debate":a.go("main.debate");break;case"reflection":a.go("main.reflection");break;case"complete":a.go("main.complete")}break;case"team_discussion":a.go("team_discussion.room")}}console.log("event id:"+b.event_id),console.log("user id : "+b.own_user_id),console.log("room type : "+b.room_type);var d=b.event_id,e=b.room_type;if("main"==e){var f=new Firebase(b.firebase_url),g=f.child("event_related/game/"+d+"/game_status");g.once("value",function(a){var b=a.val();c(e,b)},function(a){alert("event is corrupted, please confirm with mixidea administrator")})}else"team_discussion"==e&&(console.log("team_discuss_team_side : "+b.team_discuss_team_side),console.log("team_discuss_own_team : "+b.team_discuss_own_team),a.go("team_discussion.room"))}]),angular.module("angularFireHangoutApp").config(["$stateProvider","MixideaSetting",function(a,b){a.state("main",{views:{RootView:{templateUrl:b.source_domain+"views/main/main_room_layout.html"}}}).state("main.introduction",{views:{top_left:{templateUrl:b.source_domain+"views/common/title.html",controller:"TitleMgrCtrl"},container_second_top:{templateUrl:b.source_domain+"views/common/status-bar.html",controller:"StatusbarCtrl"},container_main_left_above_left_up:{templateUrl:b.source_domain+"views/main/static_video.html",controller:"StaticvideoCtrl"},container_main_left_above_right:{templateUrl:b.source_domain+"views/main/direction_intro.html",controller:"StatusUpdateCtrl"},container_main_left_below:{templateUrl:b.source_domain+"views/main/info_intro.html"},container_main_right:{templateUrl:b.source_domain+"views/main/participant_table.html",controller:"ParticipantTableParentCtrl"}}}).state("main.preparation",{views:{top_left:{templateUrl:b.source_domain+"views/common/title.html",controller:"TitleMgrCtrl"},container_second_top:{templateUrl:b.source_domain+"views/common/status-bar.html",controller:"StatusbarCtrl"},container_main_left_above_left_up:{templateUrl:b.source_domain+"views/main/static_video.html",controller:"StaticvideoCtrl"},container_main_left_above_right:{templateUrl:b.source_domain+"views/main/direction_prep.html",controller:"StatusUpdateCtrl"},container_main_left_below:{templateUrl:b.source_domain+"views/main/info_prep.html",controller:"LinkTeamdiscussCtrl"}}}).state("main.debate",{views:{top_left:{templateUrl:b.source_domain+"views/common/title.html",controller:"TitleMgrCtrl"},container_second_top:{templateUrl:b.source_domain+"views/common/status-bar.html",controller:"StatusbarCtrl"}}}).state("team_discussion",{views:{RootView:{templateUrl:b.source_domain+"views/team_discussion/t_room_layout.html"}}}).state("team_discussion.room",{views:{team_discuss_first:{templateUrl:b.source_domain+"views/team_discussion/room_name.html",controller:"TeamdiscussRoomnameCtrl"},second_left:{templateUrl:b.source_domain+"views/team_discussion/t_room_motion.html",controller:"TitleMgrCtrl"},second_middle:{templateUrl:b.source_domain+"views/team_discussion/t_room_link_main_room.html",controller:"LinkMainroomCtrl"},second_right:{templateUrl:b.source_domain+"views/team_discussion/t_room_count_prep_time.html",controller:"CountPreptimeCtrl"},container_main:{templateUrl:b.source_domain+"views/team_discussion/t_room_arguments.html",controller:"TeamdiscussArgumentsCtrl"}}})}]),angular.module("angularFireHangoutApp").controller("CountPreptimeCtrl",["$scope","MixideaSetting","$timeout",function(a,b,c){a.prep_time="start preparation";var d=null,e=new Firebase("https://mixidea.firebaseio.com/"),f=e.child("event_related/hangout_dynamic/"+b.event_id+"/preparation_timer/");f.on("value",function(a){d=a.val()},function(){console.log("fail to load timer data")});setInterval(function(){if(d){var b=Date.now(),e=b-d;if(!(0>e)){var f=e/1e3,g=f/60/60;g=Math.floor(g);var h=(f-60*g*60)/60;h=Math.floor(h),f=f-60*g*60-60*h,f=Math.floor(f),f=("0"+f).slice(-2),h=("0"+h).slice(-2),c(function(){a.prep_time=h+":"+f+" has passed"})}}},1e3)}]),angular.module("angularFireHangoutApp").controller("LinkTeamdiscussCtrl",["$scope","ParticipantMgrService","MixideaSetting",function(a,b,c){function d(){if(0!=e.length){var b="?gid=",d=c.hangout_appid,f="&gd=",g=c.own_user_id,h=c.event_id,i="team_discussion",j=a.participant_mgr.own_group;if("Audience"==a.participant_mgr.is_audience_or_debater)for(var k=0;k<a.participant_mgr.all_group_name_array.length;k++){var l=new Object;l.name=a.participant_mgr.all_group_name_array[k];var m=a.participant_mgr.all_group_name_array[k],n=e[k];l.hangout_url=n+b+d+f+g+"^"+h+"^"+i+"^"+m+"^"+j,a.team_hangout_array.push(l)}else{var l=new Object;l.name=a.participant_mgr.own_group;var m=a.participant_mgr.own_group,n=e[a.participant_mgr.own_group_id];l.hangout_url=n+b+d+f+g+"^"+h+"^"+i+"^"+m+"^"+j,a.team_hangout_array.push(l)}}}a.aaa="name",a.participant_mgr=b,a.team_hangout_array=new Array;var e=(new Object,new Array);a.$watch("participant_mgr.own_group",function(a,b){d()});var f=new Firebase(c.firebase_url),g=f.child("event_related/game_hangout_obj_list/"+c.event_id+"/team_discussion");g.on("value",function(a){e=a.val(),d()},function(a){console.log("The read failed: "+a.code)})}]),angular.module("angularFireHangoutApp").controller("ParticipantTableParentCtrl",["$scope","MixideaSetting","ParticipantMgrService",function(a,b,c){function d(){a.change_shown=!1}a.participant_mgr=c;var e=new Firebase(b.firebase_url);a.change_shown=!1,a.participant_mgr=c,a.show_change_style=function(){a.change_shown=!0},a.change_style=function(){a.change_shown=!1;var c=a.participant_mgr.debate_style,d=e.child("event_related/game/"+b.event_id+"/deb_style");d.set(c),console.log(c)},a.mouseout_change_style=function(){d()},a.cancel_change_style=function(){d()}}]),angular.module("angularFireHangoutApp").controller("ParticipantTableChildCtrl",["$scope","ParticipantMgrService","MixideaSetting",function(a,b,c){function d(b){var d=e.child("event_related/participants/"+c.event_id+"/game_role/"+a.participant_mgr.debate_style+"/"+b);d.set(null,function(a){a?console.log("cannot cancel"+a):console.log("cancel succed")})}var e=new Firebase(c.firebase_url);a.participant_mgr=b,a.own_user_id=c.own_user_id,a.join=function(b){var d=e.child("event_related/participants/"+c.event_id+"/game_role/"+a.participant_mgr.debate_style+"/"+b);d.transaction(function(a){return a?void alert("someone has already take this role"):c.own_user_id})},a.cancel=function(a){d(a)},a.decline=function(a){d(a)}}]),angular.module("angularFireHangoutApp").controller("StaticvideoCtrl",["$scope",function(a){var b=.8,c=300,d=String(c)+"px",e=c*b,f=String(e)+"px";a.video_canvas_dummy_layout={width:d,height:f}}]),angular.module("angularFireHangoutApp").controller("StatusUpdateCtrl",["$scope","MixideaSetting",function(a,b){function c(){var a=Date.now(),c=new Firebase("https://mixidea.firebaseio.com/"),d=c.child("event_related/hangout_dynamic/"+b.event_id+"/preparation_timer/");d.set(a,function(a){a?console.log("setting time failed"+a):console.log("set time succeed")})}var d=new Firebase(b.firebase_url),e=d.child("event_related/game/"+b.event_id+"/game_status");a.update_status=function(a){"preparation"==a&&c(),console.log(a),e.set(a,function(a){a?console.log("saving status failed"+a):console.log("status is updated")})}}]),angular.module("angularFireHangoutApp").controller("StatusbarCtrl",["$scope","StatusMgrService","$timeout",function(a,b,c){a.status_intro="status_bar_element",a.status_prep="status_bar_element",a.status_debate="status_bar_element",a.status_reflec="status_bar_element",a.status_complete="status_bar_element_last",a.game_status_service=b,a.$watch("game_status_service.game_status",function(b,d){console.log("status:"+b),a.status_intro="status_bar_element",a.status_prep="status_bar_element",a.status_debate="status_bar_element",a.status_reflec="status_bar_element",a.status_complete="status_bar_element_last",c(function(){switch(b){case"introduction":a.status_intro="status_bar_element_selected";break;case"preparation":a.status_prep="status_bar_element_selected"}})})}]),angular.module("angularFireHangoutApp").controller("TitleMgrCtrl",["$scope","MixideaSetting","$timeout",function(a,b,c){function d(){var b=a.data.motion.length,c=0;c=b>45?45:b>20?b:20;var d=String(c)+"em";a.dynamic_width={width:d}}a.under_edit=!1,a.data=new Object,a.data.motion="";var e=new Firebase(b.firebase_url),f=e.child("event_related/game/"+b.event_id+"/motion");f.on("value",function(b){c(function(){a.data.motion=b.val();var c=a.data.motion.length;0==c?(a.motion_sentence="motion_sentence_Red_xlarge",a.data.motion="input motion here",a.data.motion_exist=!1):60>c?(a.motion_sentence="motion_sentence_large",a.data.motion_exist=!0):100>c?(a.motion_sentence="motion_sentence_middle",a.data.motion_exist=!0):(a.motion_sentence="motion_sentence_small",a.data.motion_exist=!0)})},function(a){console.log("The read failed: "+a.code)}),a.on_motion_change=function(){d()},a.edit_start=function(){d(),a.data.motion_exist||(a.data.motion=""),a.under_edit=!0},a.save=function(){f.set(a.data.motion),a.under_edit=!1},a.cancel=function(){a.under_edit=!1}}]),angular.module("angularFireHangoutApp").factory("ParticipantMgrService",["MixideaSetting","$timeout",function(a,b){function c(a){l=new Object,p=0;for(var b in a)d(b),p++}function d(a){var b=j.child("users/user_basic/"+a);b.on("value",function(a){var b=a.val(),c=a.key();l[c]=b;var d=h(l);d==p&&e()},function(a){console.log("The read failed: "+a.code)})}function e(){b(function(){var b=a.source_domain+"images/want_you.png";switch(m){case"NA":i.participant_obj={PM:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Gov",group_id:0,login:!1,css_style:"participant_box_default"},LO:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Opp",group_id:1,login:!1,css_style:"participant_box_default"},MG:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Gov",group_id:0,login:!1,css_style:"participant_box_default"},MO:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Opp",group_id:1,login:!1,css_style:"participant_box_default"},PMR:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Gov",group_id:0,login:!1,css_style:"participant_box_default"},LOR:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Opp",group_id:1,login:!1,css_style:"participant_box_default"}};var c=k.NA;c||(c=new Object),i.audience_array.length=0;break;case"Asian":i.participant_obj={PM:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Prop",group_id:0,login:!1,css_style:"participant_box_default"},LO:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Opp",group_id:1,login:!1,css_style:"participant_box_default"},DPM:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Prop",group_id:0,login:!1,css_style:"participant_box_default"},DLO:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Opp",group_id:1,login:!1,css_style:"participant_box_default"},WG:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Prop",group_id:0,login:!1,css_style:"participant_box_default"},WO:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Opp",group_id:1,login:!1,css_style:"participant_box_default"},PMR:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Prop",group_id:0,login:!1,css_style:"participant_box_default"},LOR:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"Opp",group_id:1,login:!1,css_style:"participant_box_default"}};var c=k.Asian;c||(c=new Object),i.audience_array.length=0;break;case"BP":i.participant_obj={PM:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"OG",group_id:0,part:"Opening",login:!1,css_style:"participant_box_default"},LO:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"OO",group_id:1,part:"Opening",login:!1,css_style:"participant_box_default"},DPM:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"OG",group_id:0,part:"Opening",login:!1,css_style:"participant_box_default"},DLO:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"OO",group_id:1,part:"Opening",login:!1,css_style:"participant_box_default"},MG:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"CG",group_id:2,part:"Closing",login:!1,css_style:"participant_box_default"},MO:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"CO",group_id:3,part:"Closing",login:!1,css_style:"participant_box_default"},GW:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"CG",group_id:2,part:"Closing",login:!1,css_style:"participant_box_default"},OW:{user_name:"no applilcant",profile_pict:b,applicant:!1,id:null,group:"CO",group_id:3,part:"Closing",login:!1,css_style:"participant_box_default"}};var c=k.BP;c||(c=new Object),i.audience_array.length=0;break;default:return}for(var d in n){var e=!1;for(var h in c)if(d==c[h]){e=!0;break}if(!e){var j={applicant:!0,id:d,group:"Aud",login:!1,css_style:"participant_box_default"};i.audience_array.push(j)}}for(var h in c)i.participant_obj[h].id=c[h],i.participant_obj[h].applicant=!0;for(var h in i.participant_obj){var p=i.participant_obj[h].id;l[p]&&(i.participant_obj[h].user_name=l[p].first_name,i.participant_obj[h].profile_pict=l[p].profile_pict,i.participant_obj[h].css_style="participant_box_logoff"),o[p]&&(i.participant_obj[h].css_style="participant_box_login",i.participant_obj[h].login=!0)}for(var q=0;q<i.audience_array.length;q++){var p=i.audience_array[q].id;l[p]&&(i.audience_array[q].user_name=l[p].first_name,i.audience_array[q].profile_pict=l[p].profile_pict,i.audience_array[q].applicant=!0,i.audience_array[q].css_style="participant_box_logoff"),o[p]&&(i.audience_array[q].css_style="participant_box_login")}"BP"==m&&f(),console.log("participant obj"),console.log(i.participant_obj),console.log("audience array"),console.log(i.audience_array),g()})}function f(){for(var a in i.participant_obj_bp_open)delete i.participant_obj_bp_open[a];for(var a in i.participant_obj_bp_close)delete i.participant_obj_bp_close[a];for(var b in i.participant_obj)"Opening"==i.participant_obj[b].part&&(i.participant_obj_bp_open[b]=i.participant_obj[b]),"Closing"==i.participant_obj[b].part&&(i.participant_obj_bp_close[b]=i.participant_obj[b]);console.log("participant_obj_bp_open"),console.log(i.participant_obj_bp_open),console.log("participant_obj_bp_close"),console.log(i.participant_obj_bp_close)}function g(){switch(m){case"NA":i.all_group_name_array=["Gov","Opp"],i.all_group_id=[0,1];break;case"Asian":i.all_group_name_array=["Prop","Opp"],i.all_group_id=[0,1];break;case"BP":i.all_group_name_array=["OG","OO","CG","CO"],i.all_group_id=[0,1,2,3]}i.own_role_array.length=0,i.own_group="Audience",i.is_audience_or_debater="Audience",i.own_group_id=null;for(var b in i.participant_obj)i.participant_obj[b].id==a.own_user_id&&(i.own_role_array.push(b),i.own_group=i.participant_obj[b].group,i.own_group_id=i.participant_obj[b].group_id,i.is_audience_or_debater="debater");console.log("update_member_variable"),console.log(i.own_role_array),console.log(i.own_group),console.log(i.own_group_id),console.log(i.is_audience_or_debater)}function h(a){var b=0;for(var c in a)b++;return b}var i=new Object;i.debate_style=null,i.participant_obj=new Object,i.participant_obj_bp_open=new Object,i.participant_obj_bp_close=new Object,i.audience_array=new Array,i.own_group=null,i.is_audience_or_debater="Audience",i.all_group_name=new Array,i.own_role_array=new Array,i.all_group_name_array=new Array;var j=new Firebase(a.firebase_url),k=new Object,l=new Object,m=null,n=new Object,o=new Object,p=0,q=(new Object,j.child("event_related/game/"+a.event_id+"/deb_style"));q.on("value",function(a){m=a.val(),b(function(){i.debate_style=m}),e()},function(a){console.log("The read failed: "+a.code)});var r=j.child("event_related/participants/"+a.event_id+"/full");r.on("value",function(a){var b=a.val();n=b?b:new Object,c(n)},function(a){console.log("The read failed: "+a.code)});var j=new Firebase(a.firebase_url),s=j.child("event_related/hangout_dynamic/"+a.event_id+"/mapping_data");s.on("value",function(a){var b=a.val();a.key();o=b?b:new Object,e()},function(a){console.log("The read failed: "+a.code)});var t=j.child("event_related/participants/"+a.event_id+"/game_role/");return t.on("value",function(a){var b=a.val();k=b?b:new Object,e()},function(a){console.log("The read failed: "+a.code)}),i.get_hangout_id=function(){},i.get_user_info=function(){},i}]),angular.module("angularFireHangoutApp").factory("StatusMgrService",["MixideaSetting","$state",function(a,b){var c=new Object;c.game_status=null;var d=new Firebase(a.firebase_url),e=d.child("event_related/game/"+a.event_id+"/game_status");return e.on("value",function(a){var d=a.val();d!=c.game_status&&(c.game_status=d,b.go("main."+d))},function(a){console.log("The read failed: "+a.code)}),c}]),angular.module("angularFireHangoutApp").controller("LinkMainroomCtrl",["$scope","MixideaSetting","$timeout",function(a,b,c){var d="?gid=",e=b.hangout_appid,f="&gd=",g=b.own_user_id,h=b.event_id,i="main",j=new Firebase(b.firebase_url),k=j.child("event_related/game_hangout_obj_list/"+b.event_id+"/main");k.on("value",function(b){c(function(){var c=b.val();a.hangout_url=c+d+e+f+g+"^"+h+"^"+i})},function(a){console.log("The read failed: "+a.code)})}]),angular.module("angularFireHangoutApp").controller("TeamdiscussArgumentsCtrl",["$scope","MixideaSetting","$timeout",function(a,b,c){function d(){var b="event_related/Article_Context/"+f+"/identifier/"+g+"/"+e+"/arguments",d=h.child(b);d.on("child_added",function(b,d){var h=b.key();c(function(){a.arg_list.push({arg_id:h,event_id:f,team:e,deb_style:g})})}),d.on("child_removed",function(b,d){for(var e=b.key(),f=(a.arg_list,-1),g=0;g<a.arg_list.length;g++)a.arg_list[g].arg_id==e&&(f=g);-1!=f&&c(function(){a.arg_list.splice(f,1)})});var i="event_related/Article_Context/"+f+"/identifier/"+g+"/"+e+"/def_intro",j=h.child(i);j.on("child_added",function(b,d){var e=b.key();c(function(){a.defintro_list.push({arg_id:e})})}),a.add_argument=function(){console.log("add argument");var a={dummy:!0};d.push(a)}}a.arg_list=new Array,a.defintro_list=new Array;var e=b.team_discuss_team_side,f=b.event_id,g=null,h=new Firebase("https://mixidea.firebaseio.com/"),i=h.child("event_related/game/"+f+"/deb_style");i.on("value",function(a){g=a.val(),d()},function(a){alert("fail to retrieve debate style"+a.code)}),a.name="kkkk"}]),angular.module("angularFireHangoutApp").controller("TeamdiscussRoomnameCtrl",["$scope","MixideaSetting",function(a,b){a.room_name=b.team_discuss_team_side}]);